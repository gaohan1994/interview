https://juejin.cn/post/7161063643105198093

[a, b, c, d] => [a, c, b, d]
[0, 1, 2, 3] => [0, 2, 1, 3]

# react diff 原理

分两种主要：对单节点 diff，对多节点 diff

- 单节点 diff
  下次要渲染的节点是否在当前渲染树上有对应的 fiber 如果没有说明这个节点是新的直接创建
  如果有对比 key 是否相同不相同则直接删除当前节点并创建新节点
  如果相同则对比 type 如果 type 不同则不复用删除当前节点并创建新节点
  如果 type 相同则使用新的传入的 jsx 的 props 复用当前渲染树上的 fiber

- 多节点 diff
  核心是 2 轮遍历，优先处理更新的节点

  - 第一轮遍历
    直到第一个 key 不相同的元素为止

    - 最好情况这次遍历数量一致 key 一致，直接复用当前树的节点就好
    - 如果有一边遍历完了另一边没遍历完，则执行 新增/删除 操作就好

  - 第二轮遍历
    - 当第一轮遍历结束且还有剩余节点没有遍历到，说明有 key 不相同，这时把当前 fiber 以及其兄弟节点转成 map 类型
    - 拿到第一次遍历时结束时候的节点 index 对比下次渲染的 key 是否在 map 中存在，如果存在则比较旧 index 和 lastIndex 的大小
      如果旧 index >= lastIndex 则不动 lastIndex = 当前节点旧 index
      如果旧 index < lastIndex 则打上移动的标记
